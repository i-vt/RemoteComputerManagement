<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureC2 // Command & Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-900 text-gray-100 font-sans h-screen flex overflow-hidden selection:bg-green-500 selection:text-black">

    <aside class="w-64 bg-gray-800 border-r border-gray-700 flex flex-col justify-between z-20">
        <div>
            <div class="h-16 flex items-center justify-center border-b border-gray-700">
                <h1 class="text-2xl font-bold text-green-500 tracking-wider terminal-font glow-text">SECURE_C2</h1>
            </div>
            <nav class="mt-6 space-y-2 px-4">
                <button onclick="window.Router.navigate('stats')" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition flex items-center gap-3 text-gray-300 hover:text-white bg-gray-700 border-l-4 border-green-500">
                    <i class="fas fa-chart-pie"></i> Statistics
                </button>
                <button onclick="window.Router.navigate('network')" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition flex items-center gap-3 text-gray-300 hover:text-white">
                    <i class="fas fa-project-diagram"></i> Network Map
                </button>
                <button onclick="window.Router.navigate('control')" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition flex items-center gap-3 text-gray-300 hover:text-white">
                    <i class="fas fa-terminal"></i> Control
                </button>
                <button onclick="window.Router.navigate('files')" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition flex items-center gap-3 text-gray-300 hover:text-white">
                    <i class="fas fa-folder-open"></i> Files
                </button>
                <button onclick="window.Router.navigate('proxies')" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition flex items-center gap-3 text-gray-300 hover:text-white">
                    <i class="fas fa-network-wired"></i> Proxies
                </button>
                <button onclick="window.Router.navigate('tasks')" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition flex items-center gap-3 text-gray-300 hover:text-white">
                    <i class="fas fa-tasks"></i> Tasks
                </button>
                <button onclick="window.Router.navigate('history')" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-700 transition flex items-center gap-3 text-gray-300 hover:text-white">
                    <i class="fas fa-history"></i> Global History
                </button>
            </nav>
        </div>
        <div class="p-4 border-t border-gray-700">
            <div id="connection-status" class="flex items-center gap-2 text-sm text-red-400">
                <div class="w-2 h-2 rounded-full bg-red-500"></div> Disconnected
            </div>
            <button onclick="window.Auth.logout()" class="mt-4 text-xs text-gray-500 hover:text-white w-full text-left">
                <i class="fas fa-sign-out-alt"></i> Logout / Reset Key
            </button>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto relative bg-gray-900 relative">
        <div id="login-modal" class="absolute inset-0 z-50 bg-gray-900 flex items-center justify-center">
             <div class="bg-gray-800 p-8 rounded-xl border border-green-500 shadow-2xl w-96">
                <h2 class="text-xl font-bold mb-4 text-green-500 terminal-font">AUTHENTICATION REQUIRED</h2>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs text-gray-400">C2 Server URL</label>
                        <input type="text" id="api-url" value="http://127.0.0.1:8080" class="w-full bg-gray-900 border border-gray-700 rounded p-2 text-white focus:border-green-500 outline-none">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">X-API-KEY</label>
                        <input type="password" id="api-key" placeholder="UUID..." class="w-full bg-gray-900 border border-gray-700 rounded p-2 text-white focus:border-green-500 outline-none">
                    </div>
                    <button onclick="window.Auth.login()" class="w-full bg-green-600 hover:bg-green-500 text-black font-bold py-2 rounded transition">
                        CONNECT
                    </button>
                </div>
            </div>
        </div>

        <div class="p-8 max-w-7xl mx-auto h-full flex flex-col">
            
            <div id="page-stats" class="space-y-6">
                <h2 class="text-3xl font-light text-white">Dashboard Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <div class="text-gray-400 text-sm">Active Sessions</div>
                        <div class="text-4xl font-bold text-white mt-2" id="stat-total">0</div>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <div class="text-gray-400 text-sm">Windows Targets</div>
                        <div class="text-4xl font-bold text-blue-400 mt-2" id="stat-win">0</div>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <div class="text-gray-400 text-sm">Linux Targets</div>
                        <div class="text-4xl font-bold text-yellow-400 mt-2" id="stat-linux">0</div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                         <h3 class="text-lg font-bold mb-4">OS Distribution</h3>
                         <canvas id="osChart"></canvas>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                         <h3 class="text-lg font-bold mb-4">Activity Log</h3>
                         <div id="activity-log" class="h-48 overflow-y-auto text-sm space-y-2 terminal-font text-gray-300"></div>
                    </div>
                </div>
            </div>

            <div id="page-network" class="hidden h-full flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-3xl font-light text-white">Network Topology</h2>
                    <div class="space-x-2">
                         <button onclick="window.NetworkManager.init()" class="text-green-500 hover:text-white border border-green-500 px-3 py-1 rounded text-sm transition"><i class="fas fa-sync"></i> Refresh Graph</button>
                         <button onclick="window.NetworkManager.layout()" class="text-blue-500 hover:text-white border border-blue-500 px-3 py-1 rounded text-sm transition"><i class="fas fa-random"></i> Re-Layout</button>
                    </div>
                </div>
                <div class="flex-1 bg-gray-900 rounded-xl border border-gray-700 shadow-2xl relative overflow-hidden">
                    <div id="cy" class="absolute inset-0 w-full h-full bg-[#0d1117]"></div>
                    <div class="absolute bottom-4 right-4 bg-gray-800/80 p-3 rounded border border-gray-600 backdrop-blur-sm text-xs space-y-2 pointer-events-none z-10">
                        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.8)]"></span> C2 Control</div>
                        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-blue-500"></span> Windows Agent</div>
                        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-yellow-500"></span> Linux Agent</div>
                        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full border-2 border-green-400"></span> Proxy Active</div>
                    </div>
                </div>
            </div>

            <div id="page-control" class="hidden space-y-6">
                 <div class="flex justify-between items-center">
                    <h2 class="text-3xl font-light text-white">Host Control</h2>
                    <button onclick="window.API.refreshHosts()" class="text-green-500 hover:text-white"><i class="fas fa-sync"></i> Refresh</button>
                </div>
                <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-700 text-gray-300 text-xs uppercase tracking-wider">
                                <th class="p-4">ID</th>
                                <th class="p-4">Hostname</th>
                                <th class="p-4">IP Address</th>
                                <th class="p-4">OS</th>
                                <th class="p-4">HWID</th>
                                <th class="p-4">Scripts</th>
                                <th class="p-4 text-right">Action</th>
                            </tr>
                        </thead>
                        <tbody id="hosts-table" class="divide-y divide-gray-700 text-sm"></tbody>
                    </table>
                </div>
            </div>

            <div id="page-files" class="hidden flex flex-col h-full space-y-4">
                <div class="flex justify-between items-center shrink-0">
                    <h2 class="text-3xl font-light text-white">Interactive File Browser</h2>
                    <div class="flex items-center gap-4">
                        <select id="file-session-select" class="bg-gray-800 text-white border border-gray-600 rounded px-3 py-2 text-sm outline-none focus:border-green-500">
                            <option value="">Select Session...</option>
                        </select>
                        <button onclick="window.FileManager.browse()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded text-sm font-bold shadow-lg transition">
                            <i class="fas fa-sync"></i> Reload
                        </button>
                    </div>
                </div>

                <div class="flex gap-2 items-center bg-gray-800 p-2 rounded border border-gray-700 shrink-0">
                    <button onclick="window.FileManager.up()" class="text-gray-400 hover:text-white px-2"><i class="fas fa-arrow-up"></i></button>
                    <div class="text-gray-500 font-mono text-sm px-2">Path:</div>
                    <input type="text" id="file-path-input" class="flex-1 bg-transparent text-green-400 font-mono text-sm outline-none" value="/" onkeydown="if(event.key==='Enter') window.FileManager.browse(this.value)">
                    <button onclick="window.FileManager.browse(document.getElementById('file-path-input').value)" class="text-green-500 hover:text-white px-2"><i class="fas fa-arrow-right"></i></button>
                </div>

                <div class="flex-1 bg-gray-800 rounded-xl border border-gray-700 overflow-hidden flex flex-col shadow-inner">
                    <div class="bg-gray-750 border-b border-gray-700 px-4 py-2 flex text-xs font-bold text-gray-400 uppercase tracking-wider shrink-0">
                        <div class="w-8"></div>
                        <div class="flex-1">Name</div>
                        <div class="w-24 text-right">Size</div>
                        <div class="w-20 text-center">Perms</div>
                        <div class="w-32 text-right">Modified</div>
                    </div>
                    <div id="file-list-container" class="flex-1 overflow-y-auto p-2 space-y-1">
                        <div class="text-center text-gray-500 p-10 italic">Select a session to browse files.</div>
                    </div>
                </div>
            </div>

            <div id="page-proxies" class="hidden space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-3xl font-light text-white">Active SOCKS5 Proxies</h2>
                    <div class="space-x-2">
                        <button onclick="window.ProxyManager.checkAll()" class="text-blue-400 hover:text-white border border-blue-500 px-3 py-1 rounded text-sm transition"><i class="fas fa-globe"></i> Check All IPs</button>
                        <button onclick="window.ProxyManager.refreshList()" class="text-green-500 hover:text-white border border-green-500 px-3 py-1 rounded text-sm transition"><i class="fas fa-sync"></i> Refresh</button>
                    </div>
                </div>
                <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden mt-4">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-700 text-gray-300 text-xs uppercase tracking-wider">
                                <th class="p-4">Session ID</th>
                                <th class="p-4">Tunnel Port (C2)</th>
                                <th class="p-4">SOCKS5 Port (Local)</th>
                                <th class="p-4 text-center">Public IP</th>
                                <th class="p-4 text-right">Action</th>
                            </tr>
                        </thead>
                        <tbody id="proxies-table" class="divide-y divide-gray-700 text-sm"></tbody>
                    </table>
                </div>
            </div>

            <div id="page-tasks" class="hidden space-y-6">
                 <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h2 class="text-3xl font-light text-white">Task Operations</h2>
                        <p class="text-sm text-gray-400">Manage global broadcasts and audit execution history.</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-1 space-y-6">
                        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg relative overflow-hidden">
                            <div class="absolute top-0 right-0 -mt-2 -mr-2 w-16 h-16 bg-red-500 blur-3xl opacity-20"></div>
                            <h3 class="text-lg font-bold mb-1 text-white"><i class="fas fa-bullhorn text-red-500 mr-2"></i>New Broadcast</h3>
                            <div class="flex bg-gray-900 p-1 rounded-lg mb-4 border border-gray-700">
                                <button onclick="window.TaskManager.toggleMode('command')" id="btn-mode-cmd" class="flex-1 py-1 text-xs font-bold rounded-md bg-gray-700 text-white shadow transition">Shell Command</button>
                                <button onclick="window.TaskManager.toggleMode('module')" id="btn-mode-mod" class="flex-1 py-1 text-xs font-bold rounded-md text-gray-400 hover:text-white transition">Module</button>
                            </div>
                            <div class="space-y-4">
                                <div id="input-group-cmd">
                                    <label class="block text-xs uppercase text-gray-500 font-bold mb-2">Command String</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-2.5 text-gray-500 font-mono">$</span>
                                        <input type="text" id="broadcast-input" placeholder="whoami /all" 
                                            class="w-full bg-gray-900 border border-gray-600 rounded-lg py-2 pl-8 pr-4 text-white focus:border-red-500 focus:ring-1 focus:ring-red-500 outline-none transition font-mono">
                                    </div>
                                </div>
                                <div id="input-group-mod" class="hidden space-y-3">
                                    <div>
                                        <label class="block text-xs uppercase text-gray-500 font-bold mb-2">Select Module</label>
                                        <select id="broadcast-module-select" class="w-full bg-gray-900 border border-gray-600 rounded-lg py-2 px-3 text-white focus:border-red-500 outline-none transition text-sm">
                                            <option value="" disabled selected>Loading modules...</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs uppercase text-gray-500 font-bold mb-2">Arguments (Optional)</label>
                                        <input type="text" id="broadcast-module-args" placeholder="e.g. -v target.txt" 
                                            class="w-full bg-gray-900 border border-gray-600 rounded-lg py-2 px-3 text-white focus:border-red-500 outline-none transition font-mono text-sm">
                                    </div>
                                </div>
                                <button id="broadcast-btn" onclick="window.TaskManager.executeBroadcast()" 
                                    class="w-full bg-gradient-to-r from-red-700 to-red-600 hover:from-red-600 hover:to-red-500 text-white font-bold py-3 rounded-lg shadow-lg transform active:scale-95 transition-all">
                                    <i class="fas fa-play mr-2"></i> EXECUTE
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-2">
                        <div class="bg-gray-800 rounded-xl border border-gray-700 shadow-lg flex flex-col h-[600px]">
                            <div class="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-800/50">
                                <h3 class="font-bold text-gray-300"><i class="fas fa-history mr-2"></i>Local Audit Log</h3>
                                <button onclick="window.TaskManager.clearHistory()" class="text-gray-500 hover:text-white px-2 transition"><i class="fas fa-trash-alt"></i></button>
                            </div>
                            <div class="flex-1 overflow-y-auto scrollbar-hide">
                                <table class="w-full text-left border-collapse">
                                    <tbody id="tasks-table-body" class="divide-y divide-gray-700 text-sm"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="page-history" class="hidden space-y-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-3xl font-light text-white">Global Command History</h2>
                        <p class="text-sm text-gray-400">Server-side persistent log of all executed commands.</p>
                    </div>
                    <button onclick="window.HistoryManager.refresh()" class="text-green-500 hover:text-white border border-green-500 px-3 py-1 rounded text-sm transition">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
                <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden shadow-lg h-[600px] flex flex-col">
                    <div class="flex-1 overflow-y-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="sticky top-0 bg-gray-700 shadow-md z-10">
                                <tr class="text-gray-300 text-xs uppercase tracking-wider">
                                    <th class="p-4 w-48">Timestamp</th>
                                    <th class="p-4 w-24 text-center">Session</th>
                                    <th class="p-4 w-64">Command</th>
                                    <th class="p-4">Output</th>
                                    <th class="p-4 w-24">Status</th>
                                </tr>
                            </thead>
                            <tbody id="global-history-body" class="divide-y divide-gray-700 text-sm font-mono text-gray-300">
                                <tr><td colspan="5" class="p-4 text-center text-gray-500">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <div id="terminal-modal" class="hidden fixed inset-0 z-40 bg-black bg-opacity-80 flex items-center justify-center p-10 backdrop-blur-sm">
        <div class="bg-gray-900 w-full max-w-4xl h-3/4 rounded-lg border border-gray-600 shadow-2xl flex flex-col font-mono text-sm">
            <div class="bg-gray-800 p-2 flex justify-between items-center border-b border-gray-700">
                <span id="term-title" class="text-gray-300 ml-2">Session</span>
                <button onclick="window.Terminal.close()" class="text-red-400 hover:text-white px-3"><i class="fas fa-times"></i></button>
            </div>
            <div id="term-output" class="flex-1 p-4 overflow-y-auto text-green-400 space-y-1"></div>
            <div class="bg-gray-800 p-2 flex items-center border-t border-gray-700">
                <span class="text-green-500 mr-2 font-bold">$</span>
                <input type="text" id="term-input" class="flex-1 bg-transparent outline-none text-white" autocomplete="off" placeholder="Type command...">
            </div>
        </div>
    </div>

    <script src="js/ui.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/terminal.js"></script>
    <script src="js/proxy.js"></script>
    <script src="js/pulse.js"></script>
    <script src="js/tasks.js"></script>
    <script src="js/modules.js"></script>
    <script src="js/history.js"></script>
    <script src="js/network.js"></script>
    <script src="js/files.js"></script> <script src="js/app.js"></script>
</body>
</html>
